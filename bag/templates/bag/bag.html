{% extends 'base.html' %}
{% load static %}
{% load bag_tools %}

{% block main_content %}

<div class="container mt-5">

    <div class="row">
        <div class="col">
        <h2 class="text-center mb-4">Shopping basket</h2>

        {% if bag_items %}
            <table class="table table-borderless">
                <thead>
                <tr>
                    <th scope="col">Item</th>
                    <th scope="col">Each</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Subtotal</th>
                </tr>
                </thead>
                {% for item in bag_items %}
                <tr>
                    <td><a class="underline-hover" href="{% url 'single-product' item.product.categories.first.slug item.product.slug %}">{{ item.product.name }}</a></td>
                    <td>£{{ item.product.retail_price }}</td>
                    <td>
                        <form class="form update-form" method="POST" action="{% url 'edit-bag' item.product_id %}">
                        {% csrf_token %}
                        <div class="input-group">
                           <button type="button" class="decrement-qty btn"
                                   data-item_id="{{ product.id }}" id="decrement-qty_{{ product.id }}">
                               <span class="icon"><i class="fas fa-minus"></i></span>
                           </button>
                           <input class="form-control qty_input" type="number"
                                  name="quantity" value="{{ item.quantity }}" min="1" max="99"
                                  data-item_id="{{ product.id }}" id="id_qty_{{ product.id }}">
                           <button type="button" class="increment-qty btn"
                                   data-item_id="{{ product.id }}" id="increment-qty_{{ product.id }}">
                            <span class="icon"><i class="fas fa-plus"></i></span>
                           </button>
                        </div>
                        <div class="text-center mt-1">
                            <input type="submit" class="btn btn-sm btn-warning" name="update" value="Update">
                            <input type="submit" class="btn btn-sm btn-danger" name="remove" value="Delete">
                        </div>
                        </form>
                    </td>
                    <td>£{{ item.product.retail_price | calc_subtotal:item.quantity }}</td>
                </tr>
                {% endfor %}
                <tr>
                    <td></td>
                    <td></td>
                    <td class="text-end"><strong>Total:</strong></td>
                    <td><strong>£{{ total }}</strong></td>
                </tr>
            </table>



        {% else %}
            <h4 class="text-center mt-4">Your basket is empty</h4>
        {% endif %}

        </div>
    </div>

</div>

{% include 'bag/includes/quantity_input_script.html' %}

{% endblock %}

